(self["webpackChunk_canva_web"] = self["webpackChunk_canva_web"] || []).push([[398202],{

/***/ 535686:
function(_, __, __webpack_require__) {__webpack_require__.n_x = __webpack_require__.n;const __web_req__ = __webpack_require__;__web_req__(905716);__web_req__(375849);__web_req__(157643);__web_req__(301439);__web_req__(608051);__web_req__(279688);__web_req__(298360);self._ebd5e19490e9b70e7436d6c497657170 = self._ebd5e19490e9b70e7436d6c497657170 || {};(function(__c) {var L=__c.L;var M=__c.M;var H=__c.H;
var eAb=async function(a,b){const c=__c.Kb(__c.Ib([bAb,"create"])),[d,{xsm:e}]=await Promise.all([a.ra.post(c,cAb.serialize(b),{Fa:"recordanalyticsevent"}),__webpack_require__.me(231535).then(()=>({xsm:__c.dAb}))]);return e.deserialize(d)},hAb=async function(a,b){const c=__c.Kb(__c.Ib([bAb,"createBatch"])),[d,{wsm:e}]=await Promise.all([a.ra.post(c,fAb.serialize(b),{Fa:"recordanalyticseventbatch"}),__webpack_require__.me(231535).then(()=>({wsm:__c.gAb}))]);return e.deserialize(d)},lAb=function(a){a=
[a];let b=0;for(;a.length;){const c=a.pop();if(c!==void 0)switch(typeof c){case "boolean":b+=iAb;break;case "string":b+=c.length*jAb;break;case "number":b+=kAb;break;case "object":const d=Array.isArray(c);for(const e in c)c.hasOwnProperty(e)&&(d||a.push(e),a.push(c[e]));break;default:throw Error("Unexpected property type :"+c);}}return b},mAb=async function(a){const b=await __c.Lvb.open({name:"analytics_event_v2",version:1,KId:(c,d)=>{d.oldVersion===0&&(d=c.createObjectStore("analytics_event_v2"),
c.createObjectStore("analytics_event_metadata").put({value:0},"used_storage_bytes"),d.createIndex("user_id_index","user_id",{unique:!1}))},dld:{type:1,jnd:!0,knd:!0}},a.indexedDB);b.addEventListener("close",()=>{a.qRf=void 0});b.addEventListener("versionchange",()=>{a.qRf=mAb(a)});return b},oAb=async function(a){try{return a.qRf||(a.qRf=mAb(a)),await a.qRf}catch(b){if(b instanceof DOMException)throw new nAb(b.name,b.message);throw b;}},qAb=async function(a,b,c){var d=c.objectStore("analytics_event_v2");
c=c.objectStore("analytics_event_metadata");const [e,f]=await Promise.all([d.count(),c.get("used_storage_bytes")]);if(e>=a.Czo)throw new pAb;var g;d=((g=f===null||f===void 0?void 0:f.value)!==null&&g!==void 0?g:0)+lAb(b);if(d>=a.dAo)throw new pAb;await c.put({value:d},"used_storage_bytes")},tAb=async function(a,b){a=(await oAb(a)).transaction(["analytics_event_v2","analytics_event_metadata"],"readwrite");const c=a.objectStore("analytics_event_v2");await Promise.all([...b.map(d=>c.delete(d.eventContext.eventId)),
rAb(b.map(sAb),a),a.wsb])},vAb=async function(a,b){a=(await oAb(a)).transaction(["analytics_event_v2"],"readwrite");const c=a.objectStore("analytics_event_v2"),[d,e]=await Promise.all([c.index("user_id_index").getAll("null"),b?c.index("user_id_index").getAll(b):Promise.resolve([]),a.wsb]);return[e,d].flat().map(f=>uAb.deserialize(f.event))},wAb=async function(a,b){a=(await oAb(a)).transaction(["analytics_event_v2","analytics_event_metadata"],"readonly");const c=a.objectStore("analytics_event_v2"),
d=a.objectStore("analytics_event_metadata"),[e,f,g,h]=await Promise.all([c.index("user_id_index").count("null"),b?c.index("user_id_index").count(b):Promise.resolve(0),c.count(),d.get("used_storage_bytes"),a.wsb]);var k;return{YPp:g,TPp:(k=h===null||h===void 0?void 0:h.value)!==null&&k!==void 0?k:0,GIm:e+f}},rAb=async function(a,b){b=b.objectStore("analytics_event_metadata");const c=await b.get("used_storage_bytes");a=a.reduce((d,e)=>d+lAb(e),0);a=c.value-a;await b.put({value:a>=0?a:0},"used_storage_bytes")},
sAb=function(a){var b;return{event:uAb.serialize(a),user_id:(b=a.eventContext.userId)!==null&&b!==void 0?b:"null"}},xAb=async function(a){await a.JZg(a.Rgp);const b=async()=>{if(!a.va||a.va.status===__c.db.jE)if(a.da)await a.da.Fp("buffered_analytics.start_periodic_flushing",new Map([["sample_rate_override",.001]]),async d=>{try{await a.IRh.call()}catch(e){d.setStatus("error"),e instanceof Error&&d.addEvent("buffered_analytics.start_periodic_flushing.error",new Map([["error.name",e.name],["error.message",
e.message]]))}});else try{await a.IRh.call()}catch(d){}},c=()=>{b().finally(()=>{setTimeout(c,2E3)})};c()},yAb=async function(a,b,c){const d=lAb(b);if(d>256E3)a.errorService.error(`Attempted to dispatch an event of type '${b.event}' larger than the maximum allowed ${256E3} bytes: ${d} bytes. Discarding this event.`),c===null||c===void 0||c.setStatus("error"),c===null||c===void 0||c.addEvent("buffered_analytics.dispatch.oversized_event_discarded",new Map([["event.name",b.event],["event.size",d]]));
else try{if(a.IRh.isClosed())await a.Gdp.call(b);else return c===null||c===void 0||c.addEvent("buffered_analytics.dispatch.fallback_dispatcher_used",new Map([["reason","circuit_breaker_open"]])),a.Q8j.dispatch(b)}catch(e){return c===null||c===void 0||c.setStatus("error"),e instanceof Error&&(c===null||c===void 0||c.addEvent("buffered_analytics.dispatch.fallback_dispatcher_used",new Map([["reason","error"],["error.name",e.name],["error.message",e.message]]))),a.Q8j.dispatch(b)}},zAb=async function(a){({GIm:a}=
await wAb(a.store,a.userId));return a>0},CAb=async function(a,b){let c=[];a.da&&b?await a.da.he("buffered_analytics.flush.get_from_buffer",b,new Map([["sample_rate_override",.001]]),async g=>{try{c=await vAb(a.store,a.userId)}catch(h){throw g.setStatus("error"),h instanceof Error&&g.addEvent("buffered_analytics.flush.get_from_buffer.error",new Map([["error.name",h.name],["error.message",h.message]])),h;}}):c=await vAb(a.store,a.userId);const {YPp:d,TPp:e}=await wAb(a.store,a.userId);b===null||b===
void 0||b.addEvent("buffered_analytics.flush.buffer_size",new Map([["buffer.event_count",d],["buffer.byte_size",e]]));const f=AAb(c);await Promise.all(f.map(g=>a.da&&b?a.da.he("buffered_analytics.flush_events",b,new Map([["sample_rate_override",.001]]),async h=>BAb(a,g,h)):BAb(a,g)))},BAb=async function(a,b,c){const d=(new Date(a.qb.now())).toISOString(),e=new fAb({events:b.map(f=>{a:switch(f.type){case "TRACK":f=new DAb({...f,eventContext:new EAb({...f.eventContext,jdl:d})});break a;default:throw new __c.t(f.type);
}return f})});if(a.da&&c)await a.da.he("buffered_analytics.flush_events.send_events",c,new Map([["sample_rate_override",.001]]),async f=>{try{await __c.Nk(()=>hAb(a.wHb,e),g=>g instanceof __c.$a||g instanceof __c.mzb,3)}catch(g){throw f.setStatus("error"),g instanceof Error&&f.addEvent("buffered_analytics.flush_events.send_events.error",new Map([["error.name",g.name],["error.message",g.message]])),g;}finally{await a.D3f(b,f)}});else try{await __c.Nk(()=>hAb(a.wHb,e),f=>f instanceof __c.$a||f instanceof
__c.mzb,3)}finally{await a.D3f(b)}},AAb=function(a){const b=[];let c=0,d=[];for(const e of a){a=JSON.stringify(uAb.serialize(e)).length;if(c+a>256E3||d.length===250){b.push(d);if(b.length===2)return b;d=[];c=0}d.push(e);c+=a}d.length>0&&b.push(d);return b};__c.td.prototype.bMf=__c.ja(23,function(a,b){const c=this.uXd(a,b);return(d,e)=>c(void 0,d,e)});__c.RJa.prototype.bMf=__c.ja(22,function(a,b){const c=this.aMf(a,b);return(d,e)=>c(void 0,d,e)});
var FAb=H(()=>({countryCode:M(1)})),GAb=__c.K(()=>[1,2],1),HAb=H(()=>({Eqo:__c.dc(1),Gqo:__c.dc(2)})),EAb=H(()=>({eventId:L(1),userId:M(2),X:M(4),ec:M(18),xe:L(5),jdl:L(6),timezone:M(7),locale:M(8),location:__c.E(9,FAb),experience:M(10),Wha:(0,__c.kc)(11),channel:__c.Ma(13,GAb),Uf:__c.E(14,__c.EOa),page:__c.E(15,__c.H7a),viewport:__c.E(19,HAb),sessionId:M(17)})),DAb=H(()=>({type:__c.z("A?",4,"TRACK"),eventContext:__c.C(1,EAb),Qvb:__c.C(2,__c.rOa),Wtd:__c.fc(6),event:L(4),properties:L(5)})),uAb=__c.Ta(()=>
({type:[4,DAb]}),()=>({})),cAb=H(()=>({event:__c.C(1,uAb),Vzr:__c.ic(2)})),fAb=H(()=>({events:__c.La(1,uAb)})),bAb="ae",IAb=class extends Error{constructor(){super("Circuit is in open state right now. Please try again later.")}},JAb=class{reset(){this.sOh=this.state=0}isClosed(){return this.state===0}async call(...a){if(this.state===1&&this.Uyk+this.Mkp>this.qb.now())throw new IAb;try{const b=await this.action(...a);this.reset();return b}catch(b){throw this.sOh++,this.Uyk=this.qb.now(),this.sOh>=
this.zOn&&(this.state=1),b;}}constructor(a){this.qb=__c.cb;this.Uyk=this.sOh=this.state=0;this.action=a;this.zOn=3;this.Mkp=3E4}};var jAb=2,iAb=4,kAb=8;var KAb=class{static create(a,b=1E3,c=1E7){return new KAb(a,b,c)}async put(a){const b=(await oAb(this)).transaction(["analytics_event_v2","analytics_event_metadata"],"readwrite"),c=b.objectStore("analytics_event_v2"),d=sAb(a);await Promise.all([qAb(this,d,b),c.put(d,a.eventContext.eventId),b.wsb])}async delete(a){const b=(await oAb(this)).transaction(["analytics_event_v2","analytics_event_metadata"],"readwrite"),c=b.objectStore("analytics_event_v2");await Promise.all([c.delete(a.eventContext.eventId),
rAb([sAb(a)],b),b.wsb])}constructor(a,b=1E3,c=1E7){this.indexedDB=a;this.Czo=b;this.dAo=c}},nAb=class extends Error{constructor(a,b){super(b);this.name=a}},pAb=class extends Error{constructor(){super("Event storage quota exceeded")}};var LAb=class{static create(a,b,c,d,e,f,g,h,k=!0){if(h===void 0)return a;a=new LAb(KAb.create(h),a,b,c,d,e,f,g!==null&&g!==void 0?g:__c.aAb({a$o:!0}));k&&xAb(a);return a}async dispatch(a){return this.da?this.da.Fp("buffered_analytics.dispatch",new Map([["sample_rate_override",.001]]),async b=>yAb(this,a,b)):yAb(this,a)}async flush(){if(await zAb(this))return this.da?this.da.Fp("buffered_analytics.flush",new Map([["sample_rate_override",.001]]),async a=>CAb(this,a)):CAb(this)}async D3f(a,b){this.da&&
b?await this.da.he("buffered_analytics.flush_events.delete_from_buffer",b,new Map([["sample_rate_override",.001]]),async c=>{try{await tAb(this.store,a)}catch(d){throw c.setStatus("error"),d instanceof Error&&c.addEvent("buffered_analytics.flush_events.delete_from_buffer.error",new Map([["error.name",d.name],["error.message",d.message]])),d;}}):await tAb(this.store,a)}constructor(a,b,c,d,e,f,g,h=__c.aAb(),k=__c.cb){this.store=a;this.Q8j=b;this.wHb=c;this.va=d;this.errorService=e;this.da=f;this.userId=
g;this.JZg=h;this.qb=k;var l;this.Rgp={type:"dynamic",prefix:"analytics-",suffix:(l=this.userId)!==null&&l!==void 0?l:"null"};this.Gdp=new JAb((...n)=>a.put(...n));this.IRh=new JAb(()=>this.flush())}};var MAb=class{async dispatch(a){var b;const c=async()=>{await eAb(this.wHb,new cAb({event:a}))},d=(b=this.da)===null||b===void 0?void 0:b.bMf("online_analytics.dispatch",c);this.y4h(d?()=>d([]):c)}async flush(){}constructor(a,b,c){this.wHb=a;this.y4h=b;this.da=c}};__c.CPa=class{static create(a,b,c,d,e,f,g,h,k){a=LAb.create(new MAb(a,f,c),a,d,b,c,e,h,g,k);return new __c.CPa(a)}track(a){var b=a.eventContext;b={experience_brand:__c.Ovb.has(a.event)?b.Owb:void 0,...a.properties};a=new DAb({...a,eventContext:new EAb({...a.eventContext,jdl:(new Date(this.qb.now())).toISOString()}),properties:JSON.stringify(b)});return this.dispatchEvent(a)}async reset(){this.sHj.flush()}async dispatchEvent(a){await this.sHj.dispatch(a)}zUa(){}constructor(a,b=__c.cb){this.sHj=a;this.qb=
b}};
}).call(self, self._ebd5e19490e9b70e7436d6c497657170);}

}])
//# sourceMappingURL=sourcemaps/6b8b9017058e27c1.js.map