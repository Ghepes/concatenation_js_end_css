(self["webpackChunk_canva_web"] = self["webpackChunk_canva_web"] || []).push([[648991],{

/***/ 96090:
function(_, __, __webpack_require__) {__webpack_require__.n_x = __webpack_require__.n;const __web_req__ = __webpack_require__;__web_req__(905716);__web_req__(157643);__web_req__(927135);__web_req__(128722);__web_req__(641934);__web_req__(422043);__web_req__(879702);__web_req__(146806);__web_req__(366705);__web_req__(126195);__web_req__(816661);__web_req__(453186);__web_req__(133421);__web_req__(271214);__web_req__(693158);__web_req__(239115);__web_req__(521154);__web_req__(74155);__web_req__(240832);__web_req__(413311);__web_req__(99321);__web_req__(787894);__web_req__(420124);__web_req__(778298);__web_req__(761714);__web_req__(205301);__web_req__(835038);__web_req__(995621);__web_req__(529720);__web_req__(580634);__web_req__(945823);self._ebd5e19490e9b70e7436d6c497657170 = self._ebd5e19490e9b70e7436d6c497657170 || {};(function(__c) {var L=__c.L;var m=__c.m;var zb=__c.zb;var Ab=__c.Ab;var qa=__c.qa;var fYh,gYh,iYh,jYh,lYh,mYh,kYh,nYh;__c.eYh=async function(a,b){if((await a.dc.qyj(new __c.ZNc({na:b.key}))).Leh!==2)throw Error("Activating folder failed");b=await a.dc.GFb(new __c.aYh({na:b.id,body:new __c.rOc({na:b.key,defaultView:3})}));a=__c.lA.yJf(a.Cf,b.na);qa(a.type===3,"Returned the wrong type when updating folder");return a};
fYh=async function(a,b,c,d){if(b instanceof __c.lb)return b=new __c.ANc({brand:c,user:d,rf:Ab.Fv}),{na:a}=await a.dc.m$(new __c.LNh({brand:c,body:b})),a;throw b;};gYh=function(a,{user:b,brand:c,type:d}){b=new zb({rf:new __c.dg({brand:c,user:b,type:d})});return a.dc.CKa(new __c.lOc({Pzc:[b],nYa:!0,limit:1})).then(e=>{if(e.Uc.length===1)return e.Uc[0];qa(e.Uc.length===0);return null})};iYh=function(a,b,c){if(a.Boa(c)){var d=a.YH(c);hYh(()=>{b.id&&(d.$$-=d.removeItem(b.id,"folders"))})}};
jYh=function(a,b,c){(a=a.YH(b))&&!a.Vk&&a.na&&a.kEb({...a.na,name:c})};lYh=function(a,b){a.y1i.filter(c=>c.type===3&&c.FSa===b.id).forEach(c=>{if(c.eD){const d=m(c.na);c.kEb({...d,eD:kYh(c,b)})}lYh(a,c)})};mYh=async function(a,b){if(b.FSa)return await a.RN(new zb({id:b.FSa}))};
kYh=function(a,b){var c;a=((c=a.eD)===null||c===void 0?void 0:c.rules.filter(d=>d.origin.type==="USER"))||[];c=(b===null||b===void 0?void 0:b.Va)==="realFolder"?b.eD:b===null||b===void 0?void 0:b.fc;return{rules:(b&&(c===null||c===void 0?void 0:c.rules.map(d=>d.origin.type==="FOLDER"?d:new __c.ko({...d,origin:new __c.ONc({mb:b.id})})))||[]).concat(a)}};
nYh=function(a,b){return(a===null||a===void 0?void 0:a.entries.length)!==(b===null||b===void 0?void 0:b.entries.length)?!1:!(a===null||a===void 0||!a.entries.every(c=>b===null||b===void 0?void 0:b.entries.some(d=>c.access===d.access&&c.brand===d.brand&&c.user===d.user&&c.group===d.group&&c.role===d.role)))};__c.oYh={};__c.oYh.Jbk=__c.Xg;var pYh=__webpack_require__(400770),qYh=pYh.action,hYh=pYh.runInAction;var rYh=__c.H(()=>({na:L(1),Kdd:__c.N(2),body:__c.C(3,__c.cOc)}));var sYh=__c.H(()=>({na:L("folder",1),v_a:__c.N("removeFolder",2),body:__c.C("body",3,__c.bOc)}),{yh:1});var tYh=__c.H(()=>({brand:L("brand",1),user:L("user",2),type:L("type",3),body:__c.C("body",4,__c.rOc)}),{yh:1});var uYh=__c.H(()=>({na:L("folder",1),qob:__c.N("moveFolder",2),body:__c.C("body",3,__c.aOc)}),{yh:1});var vYh,wYh,xYh;vYh=__c.Ha(()=>__webpack_require__.me(358504).then(()=>__c.ovb));wYh=__c.Ha(()=>__webpack_require__.me(26405).then(()=>__c.oYh));xYh=__c.Ha(()=>__webpack_require__.me(200615).then(()=>__c.mA));__c.yYh=class extends Error{};__c.zYh=class extends Error{};
__c.lA=class{static G(a){__c.Q(a,{PXg:qYh,P0:qYh})}Gva(a){return this.Cf.Boa(a)?this.Cf.YH(a):this.rxh(a)}rxh(a){a=__c.rSd(a);this.Cf.UMe([a]);return a}async RN(a){if(this.Cf.Boa(a))return this.Cf.YH(a);if(__c.WVa(a))return this.Gva(a);a=await this.lbe(a);return this.P0([a])[0]}async GBc(a,b,c){if(c.numberOfItems===0)return!1;if(c.TO.getAll().some(([,d])=>d.get("folders").C8!=null))return!0;if(c.TO.getAll().some(([,d])=>d.get("folders").status===2&&d.get("folders").ub===!1))return!1;a=this.ZVh(c.key);
for(b=await a();b.continuation!=null&&b.items.length===0;)b=await a(b.continuation);return b.items.length>0}ZVh(a){if(a.rf){const b=a.rf;return c=>this.dc.yDd(new __c.cYh({list:!0,brand:b.brand,user:m(b.user,"User must exist on systemFolder key"),type:__c.Ps(b.type),limit:20,Ar:[2],ffa:!0,continuation:c}))}return b=>this.dc.IRa(new __c.dYh({list:!0,na:m(a.id,"Invalid folder key passed to FoldersController.hasSubfolders"),limit:20,Ar:[2],ffa:!0,continuation:b}))}async PZb(a,b,c,d){const {Jp:e,qUd:f,
total:g}=await this.fd.j4a(new __c.GXh({X:a,yUb:__c.kA.Osb,mb:b,limit:c,Sll:d}));return{Jp:[...e],total:g,qUd:f!==null&&f!==void 0?f:0}}async m$(a,b,c,d,e){c=new __c.ANc({name:c,type:3,fc:d,W6b:e});({na:c}=await this.dc.m$(new __c.LNh({brand:a,body:c})));__c.lA.bOb({id:c.id,key:__c.xSd(c)},1,b,a,this.Zj,this.qb);a=this.P0([c]);qa(a.length===1,"Created a folder, but it was not correctly loaded");return this.PXg(a[0],void 0)}async YVe(a,b,c,d,e,f){c=new __c.ANc({name:c,type:3,XD:d.id,fc:e,W6b:f});({na:c}=
await this.dc.m$(new __c.LNh({brand:a,body:c})));if((d===null||d===void 0?void 0:d.itemType)==="library")return this.P0([c])[0];__c.lA.bOb(d,2,b,a,this.Zj,this.qb);__c.lA.bOb({id:c.id,key:__c.xSd(c)},1,b,a,this.Zj,this.qb);a=this.P0([c]);qa(a.length===1,"Created a subfolder, but it was not correctly loaded");return this.PXg(a[0],d)}PXg(a,b){this.b6d.forEach(c=>c({item:a,na:b}));(b===null||b===void 0?void 0:b.Va)==="realFolder"&&(b.Xn(a),b.$$++);return a}async Xod(a,b,c,d){b=__c.cs(b)?__c.V("TK4V3w"):
__c.V("XlQQUA");a=await this.m$(a,c,d||b);a=await __c.eYh(this,a);a.cSi(!d);return a}$xb(a,b){return this.Cf.$xb(a,b)}WZn({brand:a,user:b,WPa:c,va:d}){this.qed||(this.qed=__c.tSd(new __c.Ao({id:"UNFOLDERED_MOCK",type:3,brand:a,user:b,Dj:0,Df:Date.now(),gp:Date.now()}),this.errorService,this.cs,this.YQ,this.A$),d?__c.IXh(()=>this.Cgg({brand:a,user:b,WPa:c}).then(),d)():this.Cgg({brand:a,user:b,WPa:c}).then());return this.qed}Cgg({user:a,brand:b,WPa:c}){var d;const e=((d=this.da)!==null&&d!==void 0?
d:(new __c.BJa).qd()).Ec("load_uploads_folder",{Hc:{name:"load_uploads_folder"}});qa(this.cs.zg);this.GPh||(d=new __c.bYh({brand:b,user:a,alias:1}),this.GPh=(c?this.v3e({user:a,brand:b}).then(f=>({na:f})):this.dc.WVh(d)).then(({na:f})=>{if(this.qed){var g;(g=this.qed)===null||g===void 0||g.kEb(f);this.Cf.Boa(this.qed.key)||this.Cf.UMe([this.qed])}else this.qed=this.P0([f])[0];return this.qed}));return this.GPh.then(f=>{e.end("ok");return f}).catch(f=>{e.end("error");this.errorService.ia(f,{ta:"Failed to fetch the uploads folder"});
throw f;})}v3e({brand:a,user:b}){return this.w3e?this.w3e:this.w3e=new Promise((c,d)=>{gYh(this,{user:b,brand:a,type:Ab.Fv}).then(e=>{e?c(e):this.dc.m$(new __c.LNh({brand:a,body:new __c.ANc({brand:a,user:b,rf:Ab.Fv})})).then(f=>c(f.na)).catch(d)}).catch(e=>{d(e)}).finally(()=>{this.w3e=void 0})})}async Lbe({item:a,X:b,userId:c,nYa:d=!1}){a=new __c.TNc({brand:b,user:c,Lj:1,nYa:d,UB:[a],limit:20});return await this.dc.CKa(a)}async rvd({item:a,X:b,userId:c,nYa:d=!1}){a=await this.Lbe({item:a,X:b,userId:c,
nYa:d});return{Uc:this.P0(a.Uc),ub:a.continuation!=null}}async Yuk(a,b){try{const {qUd:c,total:d}=await this.PZb(a,b,20);return!!(c+d)}catch(c){this.errorService.ia(c,{ta:"Failed to fetch linked Brand Kits"})}return!1}lbe(a){var b;if(((b=a.rf)===null||b===void 0?void 0:b.type)===Ab.Fv)return this.v3e({brand:a.rf.brand,user:m(a.rf.user,"User must be specified in a system folder key")});const c=this.yTn(a);this.mbe.get(c)||(a.rf?this.mbe.set(c,this.dc.Fee(new __c.iGd({brand:a.rf.brand,user:m(a.rf.user),
type:__c.Ps(a.rf.type),SX:!1})).then(d=>{this.mbe.delete(c);return d.na}).catch(d=>{var e;if(((e=a.rf)===null||e===void 0?void 0:e.type)===Ab.Fv&&d instanceof __c.lb)return fYh(this,d,a.rf.brand,m(a.rf.user));throw d;})):this.mbe.set(c,this.dc.nfk(new __c.$Nc({na:m(a),cAd:!0})).then(d=>{this.mbe.delete(c);const e=d.type;switch(e){case "SUCCESS":return d.na;case "TOMBSTONE":throw new __c.yYh;case "CAN_REQUEST_ACCESS":throw new __c.zYh;default:throw new __c.t(e);}})));return m(this.mbe.get(c))}async Kdd({Kt:a,
wLb:b}){await this.dc.Kdd(new rYh({na:m(a.id,"Cannot find folder id to be trashed"),Kdd:!0,body:new __c.cOc({na:a,wLb:b})}));a=this.Cf.YH(a);this.cXa(a)}cXa(a){var b=a.FSa;let c;hYh(()=>this.Cf.v_a(a.key));b&&(b=new zb({id:b}),c=this.Cf.YH(b),iYh(this.Cf,a.key,b));this.hqa.forEach(d=>d({item:a,na:c}))}async $5b(a,b){if(b.length!==0){var c=await this.GFb(a,b),d=e=>{e=e.w_b();for(const f of e)f.Va==="realFolder"&&(e=f.path.map(g=>g.id===c.id?{...g,name:c.title}:g),f.kEb({...f.na,path:e}),d(f))};d(c);
return c.na}}async v_a(a,b,c){await this.dc.v_a(new sYh({na:c.id,v_a:!0,body:new __c.bOc({na:c.key})}));var d=c.FSa;d&&(d=new zb({id:d}),iYh(this.Cf,c.key,d));await this.wre({na:c,userId:b,X:a,umi:void 0})}async GFb(a,b,c,d){c=new __c.rOc({na:a,name:b,fc:c,W6b:d});d=this.Cf.YH(a).title;if(b&&d!==b){const f=b.substring(0,255);jYh(this.Cf,a,f)}let e;try{if(a.rf){const f=new tYh({brand:a.rf.brand,user:m(a.rf.user),type:__c.Ps(a.rf.type),body:c});e=await this.dc.IEl(f)}else{const f=new __c.aYh({na:m(a.id),
body:c});e=await this.dc.GFb(f)}}catch(f){throw d!==b&&jYh(this.Cf,a,d),f;}return __c.lA.yJf(this.Cf,e.na)}static yJf(a,b){const c=a.YH(__c.xSd(b));c.na&&(c.$$=Math.max(c.$$+c.na.Dj-b.Dj,0));const d=c.type===3&&nYh(b.fc,c.fc)===!1;c.kEb({...b,thumbnail:b.thumbnail?b.thumbnail:c.na.thumbnail});var e;c.type===3&&(c.Xw=(e=b.defaultView)!==null&&e!==void 0?e:2);d&&lYh(a,c);return c}P0(a){return a.map(b=>{if(b.rf!==Ab.RTb){if(this.Cf.Boa(__c.xSd(b)))return __c.lA.yJf(this.Cf,b);if(b=__c.tSd(b,this.errorService,
this.cs,this.YQ,this.A$))return this.Cf.UMe([b]),b}}).filter(__c.Ua)}async qob({xa:a,Kt:b,target:c,userId:d,X:e,page:f,Xe:g}){__c.pa(b.id!==(c===null||c===void 0?void 0:c.id),"Cannot move a folder to itself");__c.pa(b.rf==null,"Cannot move a system folder");c&&(__c.pa(c.key.rf===void 0,"System Folders cannot be made parent folders"),m(c.id,"Invalid folder key passed to FoldersController.moveFolder"));c&&c.Va==="realFolder"&&c.KE&&(c=void 0);const h=this.Cf.YH(b);var k=await mYh(this,h);let l="unpinned";
h.type===3&&(k===null||k===void 0?void 0:k.type)===3&&(l=k.vaa.results.includes(h)?"pinned":"unpinned");const n=()=>this.dc.qob(new uYh({qob:!0,na:m(b.id,"require a id to move a folder"),body:new __c.aOc({na:b,to:c===null||c===void 0?void 0:c.key})}));k=async r=>{if(g&&h.access&&h.access<2){r===null||r===void 0||r.setAttribute("elevating_permission",!0);await this.uGh({Kt:b,userId:d,X:e});let u=0;await __c.Rk(async()=>{try{return r===null||r===void 0||r.addEvent(`move_attempt_${u}_started`),await n(),
r===null||r===void 0||r.addEvent(`move_attempt_${u}_successful`),!0}catch(v){if(v instanceof __c.jb)return r===null||r===void 0||r.addEvent(`move_attempt_${u}_forbidden`),u++,null;r===null||r===void 0||r.end("error");throw v;}},{initialDelay:100,$N:1E4,uW:2,Ut:1E4}).result;r===null||r===void 0||r.setAttribute("num_retries",u)}else r===null||r===void 0||r.setAttribute("elevating_permission",!1),await n();c&&c.id&&__c.lA.bOb({id:c.id,key:c.key},3,d,e,this.Zj,this.qb)};var p;const q=(p=this.da)!==null&&
p!==void 0?p:(new __c.BJa).qd();a?await q.he("move_folder",a,k):await q.Fp("move_folder",k);Promise.all([vYh(),wYh()]).then(([{phd:r},{Jbk:u}])=>{this.wa.track(r,{resourceId:u(b),resourceType:"folder",xJb:u(c===null||c===void 0?void 0:c.key),action:"moved",source:this.source,wA:h.access===6,gxk:g,Y8:l,page:f})}).catch(()=>0);this.wre({na:h,userId:d,X:e,umi:c})}async wre({na:a,X:b,userId:c,umi:d}){if(!d||d.id!==a.FSa){var e=!d||d.Va==="realFolder"&&d.KE===Ab.Fv,f=await mYh(this,a),g=new __c.mUc({id:m(a.id),
name:a.title,access:a.access,Kt:a.key});e?this.Cjc.forEach(k=>k({item:a,pj:f,gm:void 0})):this.Cjc.forEach(k=>k({item:a,gm:d,pj:f}));g=(d===null||d===void 0?void 0:d.Va)==="library"?[new __c.mUc({id:d.id,name:d.title,access:d.access,Kt:d.key}),g]:d&&d.na&&!e?d.na.path.concat(g):[g];a.kEb({...a.na,eD:a.eD&&kYh(a,d),path:g});var h=k=>{const l=m(k.na);this.Cf.y1i.filter(n=>n.type===3&&n.FSa===k.id).forEach(n=>{const p=new __c.mUc({id:m(n.id),name:n.title,access:n.access,Kt:n.key}),q=m(n.na);n.kEb({...q,
eD:n.eD&&kYh(n,k),path:l.path.concat(p)});h(n)})};a.type===3&&h(a);hYh(()=>{d&&d.Va==="realFolder"&&a.type===3&&(d.Xn(a),d.$$++);f&&(f.$$-=f.removeItem(a.id,"folders"))});e&&(e=new zb({rf:{brand:b,user:c,type:Ab.Fv}}),a.access===6&&this.Cf.Boa(e)?this.Cf.YH(e).Xn(a):xYh().then(({Sko:k})=>{a.fc&&!k(a.fc,c,b)&&this.Cf.v_a(a.key)}).catch(()=>{}))}}async uGh({Kt:a,userId:b,X:c}){var d;let e=!1;const f=(((d=this.Cf.YH(a).fc)===null||d===void 0?void 0:d.entries)||[]).map(g=>g.user===b?(e=!0,{...g,access:2}):
g);e||f.push(new __c.io({brand:c,user:b,access:2}));await this.GFb(a,void 0,{entries:f},!1)}addListener(a){switch(a.type){case "create":return this.b6d.add(a.nk),()=>this.b6d.delete(a.nk);case "move":return this.Cjc.add(a.nk),()=>this.Cjc.delete(a.nk);case "trash":return this.hqa.add(a.nk),()=>this.hqa.delete(a.nk);default:throw new __c.t(a);}}static bOb(a,b,c,d,e,f){a.key.rf==null&&e.G5b(new __c.$Xh({user:c,brand:d,item:new __c.pXh({id:a.id}),context:new __c.UXh({action:b}),IVb:[33],timestamp:f.now()})).catch(()=>
{})}constructor(a){this.Cf=(__c.lA.G(this),void 0);this.b6d=new Set;this.Cjc=new Set;this.hqa=new Set;this.w3e=this.GPh=void 0;this.mbe=new Map;this.yTn=c=>__c.ZVa(c);this.Cf=a.Cf;this.dc=a.dc;this.fd=a.fd;this.Zj=a.Zj;this.errorService=a.errorService;this.wa=a.wa;this.cs=a.cs;this.YQ=a.YQ;this.A$=a.A$;this.da=a.da;var b;this.qb=(b=a.qb)!==null&&b!==void 0?b:__c.cb}};__c.lA=__c.Q(__c.lA,{yJf:qYh});__c.Fna={};__c.Fna.tkq=__c.zYh;__c.Fna.Akq=__c.yYh;__c.Fna.hoj=__c.lA;__c.Fna.Msq=255;
}).call(self, self._ebd5e19490e9b70e7436d6c497657170);}

}])
//# sourceMappingURL=sourcemaps/e9db5ba55c4fd307.js.map