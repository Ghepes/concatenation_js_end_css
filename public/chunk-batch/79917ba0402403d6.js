;// __FILE_CONTENT_FOR__:79917ba0402403d6.js
(self["webpackChunk_canva_web"] = self["webpackChunk_canva_web"] || []).push([[849210],{

/***/ 728687:
function(_, __, __webpack_require__) {__webpack_require__.n_x = __webpack_require__.n;const __web_req__ = __webpack_require__;__web_req__(905716);__web_req__(157643);__web_req__(927135);__web_req__(136331);__web_req__(512401);__web_req__(348996);__web_req__(54807);self._ebd5e19490e9b70e7436d6c497657170 = self._ebd5e19490e9b70e7436d6c497657170 || {};(function(__c) {var d9i=function(a,b,...c){if(!c.length)return a;const d=a.k_b.get(b);d?d.push(...c):a.k_b.set(b,c);return a},f9i=function(a){return e9i(b=>b.type===a)},g9i=function(a){return e9i(b=>b.status===a)},h9i=function(a){return{start:a.pipe(g9i("start")),success:a.pipe(g9i("success")),error:a.pipe(g9i("error"))}},j9i=function(a,{files:b,ea:c,j5:d,zG:e,userId:f,X:g,fJa:h}){var k;const l=(k=a.da)===null||k===void 0?void 0:k.Ec("upload_folder",{Hc:{name:"upload_folder"},timeout:6E5});return i9i(a,{files:b,
osl:0,ea:c,j5:d,span:l,zG:e,userId:f,X:g,fJa:h}).catch(n=>{l===null||l===void 0||l.end("error");throw n;})},k9i=async function(a,b,c,d,e){b=Array.from(b).map(__c.Jf);return a.XSb(b,c,d,e)},i9i=async function(a,{files:b,osl:c,ea:d,zG:e,userId:f,X:g,fJa:h,j5:k=a.DIa(),span:l}){const {JQn:n,IQn:p}=l9i(b,c);b=await e();const q=d===null||d===void 0?void 0:d.destination,r=k9i(a,n,h,{...d,destination:d===null||d===void 0?void 0:d.destination,vE:c>0},k),u=[];for(const [w,x]of Array.from(p)){var v;let y;const A=
!q||q.itemType==="folder"&&((v=q.key.rf)===null||v===void 0?void 0:v.type)===__c.Ab.Fv;y=A?await b.m$(g,f,w):await b.YVe(g,f,w,q);if(c===0)try{const {Q4g:B}=await __webpack_require__.me(449948).then(()=>({Q4g:__c.m9i}));a.pcg.next({status:"start",Kbk:new B(y),total:n.length+p.size,IBr:A})}catch(B){}a.fa.Q7i({Yr:w,j5:k});x.length>0&&n9i(()=>{y.GP={progress:0,ariaLabel:()=>__c.S("9g9c0Q",[y.title,0]),type:"uploading"}});u.push(i9i(a,{files:x,osl:c+1,ea:{...d,destination:y},zG:e,userId:f,X:g,fJa:h,j5:k,
span:l}))}c!==0&&q&&o9i(a,{na:q,NJf:r,Pvg:p.size,Fno:c===1,span:c===1?l:void 0,fa:{j5:k,...d}});a=await Promise.all([r,...u]);return p9i(a)},l9i=function(a,b){const c=[],d=new Map;for(const e of Array.from(a)){a=q9i(e).split("/");const f=a[b],g=e.file?e.file:e;g.name.startsWith(".")||(f===null||f===void 0?0:f.startsWith("."))||(b===a.length-1?c.push(g):(a=f,d.has(a)||d.set(a,[]),d.get(a).push(e)))}return{JQn:c,IQn:d}},o9i=async function(a,{na:b,NJf:c,Pvg:d,Fno:e,span:f,fa:g}){if(b.itemType!=="library"){c=
await c;var h=c.vca.length+c.cba.length+c.aKa.length+c.Iac.length,k=h+d,l=0;d=async()=>{if(e&&b.k7i===k){var n;const q=(n=a.Ozc.get(g.j5))===null||n===void 0?void 0:n.get(b.title);if(q){let r;q.Ujc===h?n="success":(n=q.Ujc===0?"failure":"partial_failure",r="file_specific");a.fa.Zyl({...g,...q,EWp:b.id,uFl:n,Xr:r})}}const p=Math.max(l,b.k7i/k);l=p;if(p<.99&&b.Wni>0)n9i(()=>{b.GP={progress:p,ariaLabel:()=>__c.S("9g9c0Q",[b.title,p]),type:"uploading"}});else{n9i(()=>{b.GP=!1});try{const {Q4g:q}=await __webpack_require__.me(449948).then(()=>
({Q4g:__c.m9i}));a.pcg.next({status:"success",Kbk:new q(b),total:0});f===null||f===void 0||f.end()}catch(q){}return!0}};k>0?await __c.Qk(d,500).result:n9i(()=>{b.GP=!1})}},p9i=function(a){const b={mBa:[],vca:[],Fkd:[],Iac:[],cba:[],NWd:[],oqd:[],aKa:[]};a.forEach(c=>{b.mBa=[...b.mBa,...c.mBa];b.vca=[...b.vca,...c.vca];b.Fkd=[...b.Fkd,...c.Fkd];b.Iac=[...b.Iac,...c.Iac];b.cba=[...b.cba,...c.cba];b.NWd=[...b.NWd,...c.NWd];b.oqd=[...b.oqd,...c.oqd];b.aKa=[...b.aKa,...c.aKa]});return b},t9i=async function(a,
b){const c=new Set,d=new Set;return __c.vD(b.pipe(r9i(e=>{e.files.forEach(f=>d.add(f));for(const f of e.L1.getAll().values())f.forEach(g=>c.add(g));return{qQp:d.size}}),s9i(()=>c.size+d.size===a)))},u9i=async function(a,b){const c=[];let d=0;const e=new Set,f=new Set;return __c.vD(b.pipe(r9i(g=>{g.success?(g.RJf!=null&&g.RJf>0&&(d+=g.RJf-1),e.add(g.file)):(f.add(g.file),c.push({uploadType:g.type,SNa:!1,mimeType:g.file.type,fileSize:g.file.content.size,uOh:["upload_initialization_error"]}));return{pQp:e.size+
d,sOn:c}}),s9i(()=>f.size+e.size===a)))},w9i=function(a){a.BRd.pipe(e9i(b=>b.status==="start")).subscribe(b=>{const c=v9i(()=>b.upload.finished,d=>{n9i(()=>a.Ope++);d.then(()=>{n9i(()=>a.Ope--);b.upload.error||c()})},{fireImmediately:!0})})},y9i=function(a,{addEventListener:b,removeEventListener:c}){x9i(()=>a.Ope>0,()=>{b("beforeunload",a.HGk);x9i(()=>a.Ope===0,()=>{c("beforeunload",a.HGk);y9i(a,{addEventListener:b,removeEventListener:c})})})},z9i=function(a){if(a instanceof __c.S8i)return"import_failed_error";
if(a instanceof __c.U8i)return"file_resolution_error";if(a instanceof __c.V8i)return"polling_timeout_error";if(a instanceof __c.W8i){if(a=a.httpStatusCode){if(a>=400&&a<500)return"http_client_error";if(a>=500&&a<600)return"http_server_error"}return"network_error"}return"unknown"},A9i=function({files:a,na:b,JTn:c,L1:d,YRp:e}){var f;const g=new Map;if(c==null||b&&b.itemType==="library")return{files:a,Ozc:g};if(b&&!b.sbc){var h=Array.from(a).filter(A=>!q9i(A).includes("/"));h.length<a.length&&n9i(()=>
{d9i(d,2,{title:b.title,numberOfItems:b.numberOfItems,d0:b.d0,mle:c.Frb})});var k,l;return((k=b.numberOfItems)!==null&&k!==void 0?k:0)+h.length>((l=b.d0)!==null&&l!==void 0?l:c.jLb)?(n9i(()=>{d9i(d,1,{title:b.title,numberOfItems:b.numberOfItems,d0:b.d0,mle:c.Frb})}),{files:[],Ozc:g}):{files:h,Ozc:g}}const n=new Map;n.set("",{Uc:new Set,files:0});Array.from(a).forEach(A=>{if(!q9i(A).includes("/.")&&!q9i(A).startsWith(".")){var B,D=(B=q9i(A).split("/"))!==null&&B!==void 0?B:[];D.pop();var F=q9i(A).includes("/");
F&&((A=g.get(D[0]))?(A.MLa++,B=D.length,B>A.Fhi&&(A.Fhi=B)):g.set(D[0],{Pvg:0,MLa:1,Fhi:1,Ujc:0}));var G="";D.forEach((I,J)=>{if(J===0){const P=n.get("");P===null||P===void 0||P.Uc.add(I)}G+=(J===0?"":"/")+I;n.has(G)||n.set(G,{Uc:new Set,files:0});if(J<D.length-1){var O;I=(O=n.get(G))===null||O===void 0?void 0:O.Uc;I!==null&&I!==void 0&&I.has(D[J+1])||!F||(O=g.get(D[0]))&&O.Pvg++;I&&I.add(D[J+1])}});A=D.join("/");(A=n.get(A))&&A.files++}});var p;const {Uc:q,files:r}=(p=n.get(""))!==null&&p!==void 0?
p:{Uc:new Set,files:0};var u,v;if(b&&((u=b.numberOfItems)!==null&&u!==void 0?u:0)+q.size+r>((v=b.d0)!==null&&v!==void 0?v:c.jLb))return n9i(()=>{d9i(d,1,{title:b.title,numberOfItems:b.numberOfItems,d0:b.d0,mle:c.Frb})}),{files:[],Ozc:g};const w=new Set;var x;const y=(x=b===null||b===void 0?void 0:(f=b.path)===null||f===void 0?void 0:f.length)!==null&&x!==void 0?x:0;n.forEach((A,B)=>{A=A.Uc.size+A.files;B.split("/").length+y>c.Frb&&w.add(B.split("/")[0]);A>c.jLb&&w.add(B.split("/")[0])});for(const A of w.values())A!==
""&&(n9i(()=>d9i(d,0,{title:A,numberOfItems:0,d0:c.jLb,mle:c.Frb})),(k=g.get(A))&&e({...k}));e=[];for(const A of Array.from(a))a=(h=q9i(A).split("/"))!==null&&h!==void 0?h:[],a.pop(),w.has(a[0])||e.push(A);return{files:e,Ozc:g}},q9i=function(a){var b;return(b=a.webkitRelativePath)!==null&&b!==void 0?b:""},B9i=function(a){return Array.from(a).some(b=>q9i(b).includes("/"))},e9i=__webpack_require__(268245).p;var C9i=__webpack_require__(400770),D9i=C9i.action,E9i=C9i.observable,v9i=C9i.reaction,n9i=C9i.runInAction,x9i=C9i.when;var F9i=__webpack_require__(660264).m;var G9i=__webpack_require__(741430).M;var s9i=__webpack_require__(790337).$;var r9i=__webpack_require__(535921).T;var H9i=__webpack_require__(450117).B7;var J9i,I9i;
__c.K9i=class{static G(a){__c.Q(a,{Y3b:D9i,Ope:E9i.ref})}Jup(a){this.Mbk=a;if(a.zg&&!this.kJb){const b=a.zG,c=this.userId,d=this.X;c&&d&&(this.kJb=b().then(e=>e.Cgg({user:c,brand:d,WPa:a.WPa})))}}async XSb(a,b,c={},d=this.DIa()){var e;const f=this.kJb&&await this.kJb;c={...c,destination:c.destination||f};const g=(e=this.da)===null||e===void 0?void 0:e.Ec("upload_file_infos",{Hc:{name:"upload_collection_of_file_types"}}),{destination:h,pPc:k="foreground",vE:l}=c;let n=!1,p=a;const q=a.length;if(this.Rjd.has(d)){if(a=
this.Rjd.get(d))a.YGf+=q}else this.Rjd.set(d,{YGf:q,Ujc:0});e=await Promise.all(this.ODe.map(D=>typeof D==="function"?D():Promise.resolve(D)));const r=new F9i;r.subscribe(D=>this.Y3b(D,b,d,c));const u=new F9i;u.subscribe(D=>{if(D.RJf!=null&&D.RJf>0){const F=this.Rjd.get(d);F&&(F.YGf+=D.RJf-1)}});const v=new F9i;v.subscribe(D9i(D=>{D.VQ=I9i(h);if(D.status!=="start"){const {ZMh:G,...I}=D;D=I}const F=this.Rjd.get(d);if(!n||F&&F.YGf===F.Ujc)this.kFj.next(D),n=!0;this.BRd.next(D)}));const w=D=>u.next(D),
x=D=>v.next({...D,status:"start",total:q,pPc:k}),y=D=>{var F,G=this.Rjd.get(d);G&&(G.Ujc+=1);if(G=h?(F=this.Ozc.get(d))===null||F===void 0?void 0:F.get(h.title):void 0)G.Ujc+=1;v.next({...D,status:"success",total:q,pPc:k,ZMh:this.qb.now()})},A=D=>{const F=this.Rjd.get(d);F&&(F.Ujc+=1);v.next({...D,status:"error",total:q,pPc:k,ZMh:this.qb.now()})},B=D=>r.next(D);a=this.qb.now();e=e.map((D,F)=>{const G=F===this.ODe.length-1?p:p.filter(J=>D.tbc(J.type));if(!G.length)return Promise.resolve([]);let I;
p=p.filter(J=>!G.includes(J));return D.E9a(G,{VQ:I9i(h),fJa:b,N6:J=>{!I&&this.da&&g&&(I=this.da.startSpan(`upload_${J}_files`,g,{Hc:{name:"upload_files_of_type",type:J}}));return{ggi:I}},Y3b:B,uAg:w,Q8:x,gxa:y,T6a:J=>{g===null||g===void 0||g.setStatus("error");I===null||I===void 0||I.end("error");A(J)},vE:l}).catch(J=>{if(J instanceof __c.Q8i)return I===null||I===void 0||I.setAttribute("failed_to_create_resource",!0),I===null||I===void 0||I.end("error"),n9i(()=>this.L1.fTc=!0),[];I===null||I===void 0||
I.end("error");this.errorService.error(J);return Promise.reject(J)}).finally(()=>{I===null||I===void 0||I.yp()})});try{return(await Promise.all(e)).flat().reduce((D,F)=>{F.type==="media"?(D.mBa=[...D.mBa,F.upload],D.vca=[...D.vca,F.finished]):F.type==="audio"?(D.Fkd=[...D.Fkd,F.upload],D.Iac=[...D.Iac,F.finished]):F.type==="video"?(D.cba=[...D.cba,F.upload],D.NWd=[...D.NWd,F.finished]):F.type==="design"&&(D.oqd=[...D.oqd,F.upload],D.aKa=[...D.aKa,F.finished]);return D},{mBa:[],vca:[],Fkd:[],Iac:[],
cba:[],NWd:[],oqd:[],aKa:[]})}catch(D){throw g===null||g===void 0||g.setStatus("error"),n9i(()=>this.L1.FKc=!0),D;}finally{this.hWg(a,q,r,u,v,b,d,c),g===null||g===void 0||g.end()}}async E9a(a,b,c={}){var d=this.kJb&&await this.kJb;c={...c,destination:c.destination||d};d=()=>{const f=this.DIa(),{files:g,Ozc:h}=A9i({files:a,na:c===null||c===void 0?void 0:c.destination,L1:this.L1,JTn:this.Mbk,YRp:n=>this.fa.Zyl({...c,...n,j5:f,uFl:"failure",Xr:"oversized_folder"})});this.Ozc.set(f,h);Array.from(g).some(n=>
__c.Jf(n.file?n.file:n).type.startsWith("audio")&&(this.fa.source==="home"||q9i(n).includes("/")))&&n9i(()=>{var n=this.L1;n.dde.set(0,!0);return n});var k;const {zG:l}=(k=this.Mbk)!==null&&k!==void 0?k:{};if(B9i(g)&&l&&this.userId&&this.X)return j9i(this,{files:g,ea:c,j5:f,zG:l,userId:this.userId,X:this.X,fJa:b});k=Array.from(g).map(J9i);return k9i(this,k,b,c,f)};const e=c===null||c===void 0?void 0:c.destination;return e&&this.J_f&&!await this.J_f({destination:e,MLa:a.length})?{mBa:[],vca:[],Fkd:[],
Iac:[],cba:[],NWd:[],oqd:[],aKa:[]}:d()}async hWg(a,b,c,d,e,f,g,h){({qQp:b}=await t9i(b,c));if(b!==0){var {pQp:k,sOn:l}=await u9i(b,d),{destination:n,fg:p,Yjc:q,i2b:r,gaa:u}=h||{},v=new Map,w=new Set,x=new Set;await __c.vD(e.pipe(G9i(y=>{var A,B,D,F,G;if(y.status!=="start"){var I,J,O=(J=v.get(y.upload))!==null&&J!==void 0?J:{SNa:!1,uploadType:y.type,mimeType:y.file.type,fileSize:y.file.content.size,width:y.width,height:y.height,duration:y.duration,B6h:(A=y.upload.metrics)===null||A===void 0?void 0:
A.B6h,aQh:(B=y.upload.metrics)===null||B===void 0?void 0:B.aQh,b5h:(D=y.upload.metrics)===null||D===void 0?void 0:D.b5h,PJf:(F=y.upload.metrics)===null||F===void 0?void 0:F.PJf,BSe:(G=y.upload.metrics)===null||G===void 0?void 0:G.BSe,Eaa:[...((I=y.Eaa)!==null&&I!==void 0?I:[])],vE:y.vE};A=y.ZMh-a;if(y.status==="success"){w.add(y.upload);x.delete(y.upload);var P;O={...O,SNa:!0,h9a:A,Eaa:[...((P=y.Eaa)!==null&&P!==void 0?P:[])]}}else if(y.status==="error"){x.add(y.upload);P=z9i(y.error);var R;O={...O,
h9a:A,uOh:[...((R=O.uOh)!==null&&R!==void 0?R:[]),P]}}v.set(y.upload,O)}}),s9i(()=>w.size+x.size===k)));this.fa.hWg({SNa:x.size===0&&l.length===0,h9a:this.qb.now()-a,$Ph:[...l,...v.values()],component:f,fg:p,j5:g,Yjc:q,VQ:I9i(n),i2b:r,gaa:u})}}Y3b(a,b,c,d){const e=a.files,f=a.L1,{destination:g,fg:h,Yjc:k,i2b:l,gaa:n,vE:p}=d||{};e.length&&this.fa.uzl({files:e,component:b,wD:"hosted",fg:h,Yjc:k,j5:c,VQ:I9i(g),i2b:l,gaa:n,vE:p});for(const [q,r]of f.getAll()){let u;switch(q){case 3:u="corrupted";break;
case 0:u="unsupported_mime_type";break;case 1:u="too_large"}u&&this.fa.uzl({files:r,component:b,wD:"hosted",fg:h,Xr:u,Yjc:k,j5:c,VQ:I9i(g),i2b:l,gaa:n,vE:p})}for(const [q,r]of a.L1.getAll())__c.Z8i(this.L1,q,...r)}constructor({ODe:a,fa:b,errorService:c,L1:d,window:e,za:f,userId:g,X:h,J_f:k,DIa:l=__c.Wa,qb:n=__c.cb}){this.ODe=(__c.K9i.G(this),void 0);this.Ozc=new Map;this.BRd=new H9i;this.Iac=h9i(this.BRd.pipe(f9i("audio")));this.aKa=h9i(this.BRd.pipe(f9i("design")));this.vca=h9i(this.BRd.pipe(f9i("media")));
this.cba=h9i(this.BRd.pipe(f9i("video")));this.rdk=h9i(this.BRd.pipe(f9i("file")));this.pcg=new H9i;this.RTn={start:this.pcg.pipe(e9i(p=>p.status==="start")),success:this.pcg.pipe(e9i(p=>p.status==="success"))};this.kFj=new H9i;this.Xkh=this.kFj.pipe();this.Rjd=new Map;this.Ope=0;this.HGk=p=>{this.Ope>0&&(p.preventDefault(),p.returnValue="")};this.ODe=a;this.fa=b;this.errorService=c;this.L1=d;this.DIa=l;this.qb=n;this.da=f===null||f===void 0?void 0:f.qd("ui.search.uploader");this.userId=g;this.X=
h;this.J_f=k;w9i(this);e&&y9i(this,e)}};J9i=a=>a.file?a.file:a;I9i=a=>{if(a)switch(a.itemType){case "folder":return{type:"folder",...a.key};case "library":return{type:"library",id:a.id};default:throw new __c.t(a);}};
}).call(self, self._ebd5e19490e9b70e7436d6c497657170);}

}])
//# sourceMappingURL=https://chunk-composing.canva.com/chunk-batch-sm/33_sourcemaps/79917ba0402403d6.js.map